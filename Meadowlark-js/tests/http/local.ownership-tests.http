### Set `ACCESS_TOKEN_REQUIRED=true` environment variable before `yarn start:local`
# Be sure to load all descriptors into the database first.


@auth_header_1=Authorization: bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJlZC1maS1tZWFkb3dsYXJrIiwiYXVkIjoibWVhZG93bGFyayIsInJvbGVzIjpbInZlbmRvciJdLCJzdWIiOiJzdXBlci1ncmVhdC1TSVMiLCJqdGkiOiIyNGMyMDIyMC1mMjg1LTRlNjMtYThmNC1iMmRkYzM5MzAwMDQiLCJpYXQiOjE2NTg1MjM0MDgsImV4cCI6MjY1ODUyNzAwOH0.S2C44HoFMr5ZYSUkbZoAV2pz7Z1Xi40yynH17GOBVoY
@auth_header_2=Authorization: bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJlZC1maS1tZWFkb3dsYXJrIiwiYXVkIjoibWVhZG93bGFyayIsInJvbGVzIjpbInZlbmRvciJdLCJzdWIiOiJzdXBlci1ncmVhdC1TSVMiLCJqdGkiOiI4MjVkNDRiOC1hODExLTRjZmYtYmVmOC1jYzhhNjYxNjliZTAiLCJpYXQiOjE2NTg1MjQyMzUsImV4cCI6MjY1ODUyNzgzNX0.DR9-ixkAs-EUIsoRjYYGY-NLal2o8wrDYYLcKFfb3_I


### Try creating a new resource with authorization header - expect success.
POST http://localhost:3000/local/v3.3b/ed-fi/EducationContents
content-type: application/json
{{auth_header_1}}

{
    "contentIdentifier": "first",
    "namespace": "4321",
    "shortDescription": "abc",
    "contentClassDescriptor": "uri://ed-fi.org/ContentClassDescriptor#Presentation",
    "learningResourceMetadataURI": "2143"
}

### Re-POST with different authorization header - expect 403.
POST http://localhost:3000/local/v3.3b/ed-fi/EducationContents
content-type: application/json
{{auth_header_2}}

{
    "contentIdentifier": "first",
    "namespace": "4321",
    "shortDescription": "abc",
    "contentClassDescriptor": "uri://ed-fi.org/ContentClassDescriptor#Presentation",
    "learningResourceMetadataURI": "2143"
}

### Try getting that resource without authorization header - expect 401.
GET http://localhost:3000/local/v3.3b/ed-fi/educationContents/YKe0uvuOUdWgG2M086S1i1-o6lg_BmwjFVQyJA

### Try getting that resource using the same authorization header that created the record - expect success.
GET http://localhost:3000/local/v3.3b/ed-fi/educationContents/YKe0uvuOUdWgG2M086S1i1-o6lg_BmwjFVQyJA
{{auth_header_1}}

### Try getting that resource with a different authorization header - expect 403
GET http://localhost:3000/local/v3.3b/ed-fi/educationContents/YKe0uvuOUdWgG2M086S1i1-o6lg_BmwjFVQyJA
{{auth_header_2}}

### Try updating that resource using the same authorization header that created the record - expect success.
PUT http://localhost:3000/local/v3.3b/ed-fi/EducationContents/YKe0uvuOUdWgG2M086S1i1-o6lg_BmwjFVQyJA
content-type: application/json
{{auth_header_1}}

{
    "contentIdentifier": "first",
    "namespace": "4321",
    "shortDescription": "abcdefghijklmnopqrstuvwxyz",
    "contentClassDescriptor": "uri://ed-fi.org/ContentClassDescriptor#Presentation",
    "learningResourceMetadataURI": "2143"
}

### Try updating the resource with wrong authorization header - expect 403
PUT http://localhost:3000/local/v3.3b/ed-fi/EducationContents/YKe0uvuOUdWgG2M086S1i1-o6lg_BmwjFVQyJA
content-type: application/json
{{auth_header_2}}

{
    "contentIdentifier": "first",
    "namespace": "4321",
    "shortDescription": "abc",
    "contentClassDescriptor": "uri://ed-fi.org/ContentClassDescriptor#Presentation",
    "learningResourceMetadataURI": "2143"
}

### Creating a 2nd resource with 2nd authorization header - expect success.
POST http://localhost:3000/local/v3.3b/ed-fi/EducationContents
content-type: application/json
{{auth_header_2}}

{
    "contentIdentifier": "second",
    "namespace": "43210",
    "shortDescription": "abcd",
    "contentClassDescriptor": "uri://ed-fi.org/ContentClassDescriptor#Presentation",
    "learningResourceMetadataURI": "21433"
}

### Create Resource from token with HOST/FULL_ACCESS authorization
@auth_header_3=Authorization: bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJlZC1maS1tZWFkb3dsYXJrIiwiYXVkIjoibWVhZG93bGFyayIsInJvbGVzIjpbImhvc3QiXSwic3ViIjoic3VwZXItZ3JlYXQtU0lTIiwianRpIjoiODI1ZDQ0YjgtYTgxMS00Y2ZmLWJlZjgtY2M4YTY2MTY5YmUwIiwiaWF0IjoxNjU4NTI0MjM1LCJleHAiOjI2NTg1Mjc4MzV9.8JV9V_-YhxfXz05k9XblkLcxFRMl-FmN_gKiME69QHM
POST  http://localhost:3000/local/v3.3b/ed-fi/students/
content-type: application/json
reference-validation: true
{{auth_header_3}}

{ 
    "studentUniqueId": "s0zf6d1123d3e12",
    "firstName": "Hello",
    "lastSurname": "World",
    "birthDate": "2001-01-01",
    "birthCountryDescriptor": "uri://ed-fi.org/CountryDescriptor#US"
}

### Delete Resource with HOST/FULL_ACCESS authorization
DELETE http://localhost:3000/local/v3.3b/ed-fi/students/lqojnbvIhjZVo_T-ojp81kjuAC-sjppXmgcZGA
content-type: application/json
reference-validation: true
{{auth_header_3}}


### Query resource using 1st authorization header - expect only 1st record.
GET http://localhost:3000/local/v3.3b/ed-fi/educationContents/
{{auth_header_1}}

### Query resource using 2nd authorization header - expect only 2nd record.
GET http://localhost:3000/local/v3.3b/ed-fi/educationContents/
{{auth_header_2}}

### Attempt to retrieve first record in a query using 1st token - expect to receive it
GET http://localhost:3000/local/v3.3b/ed-fi/educationContents?contentIdentifier=first
{{auth_header_1}}


### Attempt to retrieve first record in a query using 2nd token - expect empty array
GET http://localhost:3000/local/v3.3b/ed-fi/educationContents?contentIdentifier=first
{{auth_header_2}}


### Try deleting 1st resource using the wrong authorization header - expect 403
DELETE http://localhost:3000/local/v3.3b/ed-fi/educationContents/YKe0uvuOUdWgG2M086S1i1-o6lg_BmwjFVQyJA
{{auth_header_2}}

### Try deleting 1st resource using the same authorization header that created the record - expect success.
DELETE http://localhost:3000/local/v3.3b/ed-fi/educationContents/YKe0uvuOUdWgG2M086S1i1-o6lg_BmwjFVQyJA
{{auth_header_1}}

### Delete 2nd resource using the same authorization header that created the record - expect success.
DELETE http://localhost:3000/local/v3.3b/ed-fi/educationContents/1vvBcOeM1WsZkfwgE-edz-dPgkHJY7uyBrEkuQ
{{auth_header_2}}
